<!doctype html>

<html lang='en'>
	
	<head>
			
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

		<!-- Compiled and minified CSS -->
  		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

  		<!-- Compiled and minified JavaScript -->
  		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

  		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

		<title>Flash Card Generator</title>

		<style>
			
			

		</style>

	</head>

	<body>
		
		<div class="container">

			<div class="row">

				<div class="col m12"> 
					
					<h1 class="center-align">FlashCard Generator</h1>
				
				</div>

			</div>

			<div id="formsection" class="row">
    
		    	<form class="col m12">
			      
			      <div class="row">

			        <div class="input-field col m12">
			          <input placeholder="Fulltext" id="fulltext" type="text" class="validate">
			          <label for="fulltext">Full Text</label>
			        </div>

			        <div class="input-field col m12">
			          <input placeholder="Cloze" id="cloze" type="text" class="validate">
			          <label for="Cloze">Cloze</label>
			        </div>
			      
			      </div>

			      <input id="submit" type="submit" value="Submit">
    
				</form>
  	
  			</div>

			<div id="cards"></div>
		
		</div>

	</body>

	<script>

	$(document).ready(function() {

		$.ajax({

			url: "http://127.0.0.1:8080/Read?",
			method: 'GET',

		}).done(function(result){

			//read from db
			console.log("result from server is");
			console.log(result);
			populateCards(result);

		});

		//alert("hello world");
		$("#submit").on("click", function(e){

			e.preventDefault();
			console.log("clicked");
			//console.log(e);

			//console.log($("#fulltext").val());
			//console.log($("#cloze").val());

			var fText = $("#fulltext").val();
			var bText = $("#cloze").val();

			//var bCard = new BasicCard(fText,bText);

			//console.log(bCard.front);
			var url = "http://127.0.0.1:8080/Card?" + "ft=" + fText + "&" + "bt=" + bText;

			$.ajax({
		    
		          url: url,
		          method: 'GET',
		    
		    }).done(function(result) {

		    	var row = $("<div>");
		    	row.attr("class", "row");
		    	$("#cards").append(row);

		    	createBasicCard(result, row);
		    	createClozeCard(result, row);



		    }).fail(function(err) {

		        throw err;

		    });

		})


	});

	function populateCards(array) {

		var row = $("<div>");
		row.attr("class", "row");
		$("#cards").append(row);

		for (var i = 0; i <array.length; i++) {

			console.log(array[i]);
		    
		    createBasicCard(array[i], row);
		    createClozeCard(array[i], row);
		
		}

	}


	function createBasicCard(array, row) {

		//var row = $("<div>");
		//row.attr("class", "row");

		var col = $("<div>");
		col.attr("class", "col m6");

		var color = $("<div>");
		color.attr("class", "card blue-grey darken-1");

		var content = $("<div>");
		content.attr("class", "card-content white-text center-align");

		var title = $("<span>");
		title.attr("class", "card-title");
		title.html("Basic Flash Card");

		var pContent = $("<p>");
		//pContent.attr("class", "content");
		//pContent.attr("data_front", array[0].front.replace(/%20/g, " "));
		//pContent.attr("data_back", array[0].front.replace(/%20/g, " "));
		pContent.html(array[0].front.replace(/%20/g, " "));

		/*
		var pFront = $("<p>");
		pFront.html(array[0].front.replace(/%20/g, " "));

		var pBack = $("<p>");
		pBack.html(array[0].back.replace(/%20/g, " "));
		*/

		var action = $("<div>");
		action.attr("class", "card-action");

		var linkF = $("<a>");
		linkF.attr("class", "f");
		linkF.attr("data_front", array[0].front.replace(/%20/g, " "))
		linkF.html("Front");

		var linkB = $("<a>");
		linkB.attr("class", "b");
		linkB.attr("data_back", array[0].back.replace(/%20/g, " "))
		linkB.html("Back");

		//action.html("<a class='f' href='#'>Front</a>" +
		//            "<a class='b' href='#'>Back</a>");

		action.append(linkF);
		action.append(linkB);

		content.append(title);
		content.append(pContent);
		//content.append(pFront);
		//content.append(pBack);
		color.append(content);
		color.append(action);
		col.append(color);
		row.append(col);
		


		//$("#cards").append(row);


	}

	function createClozeCard(array, row) {

		//var row = $("<div>");
		//row.attr("class", "row");

		var col = $("<div>");
		col.attr("class", "col m6");

		var color = $("<div>");
		color.attr("class", "card blue-grey darken-1");

		var content = $("<div>");
		content.attr("class", "card-content white-text center-align");
		var title = $("<span>");
		title.attr("class", "card-title");
		title.html("Cloze Flash Card");

		//var pFullText = $("<p>");
		//pFullText.html(array[1].fullText.replace(/%20/g, " "));

		//var pCloze = $("<p>");
		//pCloze.html(array[1].cloze.replace(/%20/g, " "));

		//var pPartial = $("<p>");
		//pPartial.html(array[1].partial.replace(/%20/g, " "));

		var pContent = $("<p>");
		pContent.html(array[1].partial.replace(/%20/g, " "));

		var action = $("<div>");
		action.attr("class", "card-action");

		var linkFull = $("<a>");
		linkFull.attr("class", "full");
		linkFull.attr("data_full", array[1].fullText.replace(/%20/g, " "))
		linkFull.html("Full");

		var linkTest = $("<a>");
		linkTest.attr("class", "test");
		linkTest.attr("data_test", array[1].partial.replace(/%20/g, " "))
		linkTest.html("Test");

		var linkAns = $("<a>");
		linkAns.attr("class", "answer");
		linkAns.attr("data_answer", array[1].cloze.replace(/%20/g, " "))
		linkAns.html("Answer");

		//action.html("<a class='f' href='#'>Front</a>" +
		//            "<a class='b' href='#'>Back</a>");

		action.append(linkFull);
		action.append(linkTest);
		action.append(linkAns);



		//action.html("<a href='#'>Full</a>" +
		 //           "<a href='#'>Test</a>" +
		   //         "<a href='#'>Answer</a>");

		content.append(title);
		content.append(pContent);
		//content.append(pFullText);
		//content.append(pCloze);
		//content.append(pPartial);
		color.append(content);
		color.append(action);
		col.append(color);

		row.append(col);

		//console.log(row);

		//$("#cards").append(col);

	}

	$(document).on("click", ".f", function(e){

		//console.log($(this).attr("data_front"));
		//console.log($(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML);
		//console.log($(this).parentNode);
		$(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML = $(this).attr("data_front");

	})

	$(document).on("click", ".b", function(e){

		//console.log($(this).attr("data_back"));
		//console.log($(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML);
		//console.log($(this).parentNode);
		$(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML = $(this).attr("data_back");

	})

	$(document).on("click", ".full", function(e){

		//console.log($(this).attr("data_back"));
		//console.log($(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML);
		//console.log($(this).parentNode);
		$(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML = $(this).attr("data_full");

	})

	$(document).on("click", ".test", function(e){

		//console.log($(this).attr("data_back"));
		//console.log($(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML);
		//console.log($(this).parentNode);
		$(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML = $(this).attr("data_test");

	})

	$(document).on("click", ".answer", function(e){

		//console.log($(this).attr("data_back"));
		//console.log($(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML);
		//console.log($(this).parentNode);
		$(this).parent().parent()[0].childNodes[0].childNodes[1].innerHTML = $(this).attr("data_answer");

	})

	</script>

</html>